<%= form_with(model: listing, local: true) do |form| %>
  <header>
    <a href="/listings/dashboard" class="listings-back-button">&lt; ilan paneline dön</a>
    <h2>Topluluk İlanı Oluşturun</h2>
  </header>
  <div class="listing-form-inner">
    <%= render partial: "form_errors", locals: { listing: listing } %>

    <div id="listingform-data"
      data-listing="<%= listing.to_json(only: %i[id title body_markdown category cached_tag_list]) %>"
      data-organizations="<%= @organizations.to_json(only: %i[id name]) %>"
      data-categories-for-select="<%= select_options_for_categories.to_json %>"
      data-categories-for-details="<%= categories_available.transform_values { |value_hash| value_hash.except(:cost) }.values.to_json %>">
      <div style="height: 745px;">
        <div class="field">
          <%= form.label "title" %>
          <%= form.text_field "title", placeholder: "Maksimum 128 karakter, düz metin" %>
        </div>
        <div class="field">
          <%= form.label "body_markdown", "İçerik (markdown)" %>
          <%= form.text_area "body_markdown", placeholder: "Maksimum 400 karakter, maksimum 12 satır sonu, resme izin verilmez" %>
        </div>

        <div class="field" style="padding-top: 9px">
          <label>Kategori</label>
          <select>
            <option>
              Konferans SFP (1 Kredi)
            </option>
          </select>
          <details>
            <summary>Kategori ayrıntıları / kurallar</summary>
          </details>
        </div>
        <%# The following tag_list field is overriden by the Tags JS component
        from the listingForm. We keep this form field in place to facilitate
        SSR. By having the form field loaded on the DOM first with this view,
        we prevent the screen from "jumping" once the deferred JS is loaded
        and executed. %>
        <div class="field">
          <%= form.label "tag_list", "Tags" %>
          <%= form.text_field "tag_list", placeholder: "Maksimum 8 etiket, virgülle ayrılmış, boşluk veya özel karakter yok" %>
        </div>
      <% if @organizations.present? && @organizations.size > 0 %>
        <div class="field">
          <%= form.label "organization_id", "Bir organizasyon altında yayınlayın:" %>
          <%= form.select :organization_id, "None" => "None" %>
          <p><em>Bir kuruluş adına yayınlamak, kuruluşun kredisini harcar.</em></p>
        </div>
        <% end %>
      </div>
    </div>
      <% unless @organizations.present? %>
        <%= javascript_packs_with_chunks_tag "listingForm", defer: true %>
      <% end %>
    <div class="field">
      <%= form.label "location", "Konum (Etkinlikler vb. İçin geçerliyse)" %>
      <%= form.text_field "location", placeholder: "Maksimum 32 karakter, düz metin" %>
    </div>

    <div class="actions">
      <br />
      <p>Bir taslak kaydetmek için kredi ödemeyeceksiniz.</p>
      <%= form.button "TASLAĞI KAYDET", type: "submit", name: "listing[action]", class: "cta cta-main-listing-form cta-draft", value: "draft" %>
      <% if @credits.size > 0 || (@organizations.present? && @organizations.sum(:unspent_credits_count) > 0) %>
        <%= form.submit "LİSTEYİ YAYINLA", class: "cta cta-main-listing-form" %>
      <% else %>
        <p>Bir giriş oluşturmak için en az bir krediye ihtiyacınız var.</p>
        <a href="/credits/new" class="cta cta-main-listing-form" data-no-instant>Şimdi Kredi Satın Alın</a>
      <% end %>
    </div>
    <p><em><%= community_name %> yöneticileri, doğruluğu sağlamak için etiketleri ve kategorileri değiştirebilir. Ayrıca uygunsuz ilanları kaldırabilir ve geri ödeme yapabiliriz.</em></p>
    <p><em>Girişler, yayınlandıktan veya "dokundurulduktan" 30 gün sonra sona erer.</em></p>
    <div class="listings-current-credits">
      <% if @credits.size == 0 && (@organizations.blank? || @organizations.sum(:unspent_credits_count).zero?) %>
        <h3>Girişler Kredi Gerektirir</h3>
      <% end %>
      <div class="listings-current-credits-inner">
        <%= pluralize @credits.size, "credit" %> krediniz var — <a target="_blank" rel="noopener noreferrer" href="/credits/purchase" data-no-instant>Daha fazla satın al</a>
      </div>
      <% if @organizations.present? %>
        <div class="listings-current-credits-inner">
        <select id="org-credits-select" class="org-credits-select">
          <% @organizations.each do |org| %>
            <option value="<%= org.id %>" data-credits="<%= org.credits.unspent.size %>"><%= org.name %></option>
          <% end %>
        </select>
        organizasyonu <span id="org-credits-number"><%= @organizations.first.credits.unspent.size %></span> krediye sahip -
          <a id="org-credits-purchase-link" target="_blank" rel="noopener noreferrer" href="/credits/purchase?organization_id=<%= @organizations.first.id %>" data-no-instant>Daha fazla satın al</a>
        </div>
        <%= javascript_packs_with_chunks_tag "listingForm", "orgCreditsSelector", defer: true %>
      <% end %>
    </div>
  </div>
<% end %>
